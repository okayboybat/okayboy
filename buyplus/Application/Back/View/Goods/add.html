<extend name="Layout/back" />

<block name="title">商品添加</block>

<block name="content">

	<div id="content">
		<div class="page-header">
			<div class="container-fluid">
				<div class="pull-right">
					<button type="submit" form="form-add" data-toggle="tooltip" title="保存" class="btn btn-primary"> <i class="fa fa-save"></i>
					</button>
					<a href="{:U('list')}" data-toggle="tooltip" title="取消" class="btn btn-default"> <i class="fa fa-reply"></i>
					</a>
				</div>
				<h1>商品</h1>
				<ul class="breadcrumb">
					<li>
						<a href="{:U('Manage/index')}">首页</a>
					</li>
					<li>
						<a href="{:U('list')}">商品</a>
					</li>
				</ul>
			</div>
		</div>
		<div class="container-fluid">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<i class="fa fa-pencil"></i>
						添加商品
					</h3>
				</div>
				<div class="panel-body">
					<form action="{:U('add')}" method="post" enctype="multipart/form-data" id="form-add" class="form-horizontal">
						<ul class="nav nav-tabs">
							<li class="active">
								<a href="#tab-general" data-toggle="tab">基本信息</a>
							</li>
							<li class="">
								<a href="#tab-description" data-toggle="tab">详细描述</a>
							</li>
							<li class="">
								<a href="#tab-seo" data-toggle="tab">SEO信息</a>
							</li>
							<li class="">
								<a href="#tab-linked" data-toggle="tab">关联信息</a>
							</li>
							<li class="">
								<a href="#tab-gallery" data-toggle="tab">图像设置</a>
							</li>
							<li class="">
								<a href="#tab-attribute" data-toggle="tab">属性</a>
							</li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="tab-general">

																
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-name">商品名称</label>
									<div class="col-sm-10">
										<input type="text" name="name" value="" placeholder="名称" id="input-name" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-image">商品图像</label>
									<div class="col-sm-10">
										<input type="file" name="image" value="" id="input-image"/>
									</div>
								</div>
										
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-SKU">SKU</label>
									<div class="col-sm-10">
										<input type="text" name="SKU" value="" placeholder="SKU" id="input-SKU" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-UPC">UPC</label>
									<div class="col-sm-10">
										<input type="text" name="UPC" value="" placeholder="UPC" id="input-UPC" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-price">价格</label>
									<div class="col-sm-10">
										<input type="text" name="price" value="0.00" placeholder="销售价格" id="input-price" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-market_price">市场价格</label>
									<div class="col-sm-10">
										<input type="text" name="market_price" value="0.0" placeholder="市场价格" id="input-market_price" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-quantity">库存数量</label>
									<div class="col-sm-10">
										<input type="text" name="quantity" value="0" placeholder="库存" id="input-quantity" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-minimum">最少销售数量</label>
									<div class="col-sm-10">
										<input type="text" name="minimum" value="1" placeholder="最少销售数量" id="input-minimum" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-is_subtract">是否减库存</label>
									<div class="col-sm-10">
										<input type="checkbox" name="is_subtract" value="1" id="input-is_subtract" checked class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-is_shipping">是否支持配送</label>
									<div class="col-sm-10">
										<input type="checkbox" name="is_shipping" value="1" checked id="input-is_shipping" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-date_available">起售日期</label>
									<div class="col-sm-3">
										<div class="input-group date">
						                 	<input name="date_available" value="{:date('Y-m-d')}" placeholder="供货日期" data-date-format="YYYY-MM-DD" id="input-date_available" class="form-control" type="text">
						                 	<span class="input-group-btn">
						                	<button class="btn btn-default" type="button">
						                    	<i class="fa fa-calendar"></i>
						                    </button>
						                  </span>
						                </div>
									</div>
								</div>
												
								<div class="form-group">

									<label class="col-sm-2 control-label" for="input-length">尺寸 (L x W x H)</label>
						              <div class="col-sm-10">
						                <div class="row">
						                  <div class="col-sm-4">
						                    <input name="length" value="0" placeholder="长" id="input-length" class="form-control" type="text">
						                  </div>
						                  <div class="col-sm-4">
						                    <input name="width" value="0" placeholder="宽" id="input-width" class="form-control" type="text">
						                  </div>
						                  <div class="col-sm-4">
						                    <input name="height" value="0" placeholder="高" id="input-height" class="form-control" type="text">
						                  </div>
						                </div>
						              </div>
									
								</div>

								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-length_unit_id">长度单位</label>
									<div class="col-sm-10">
										<select name="length_unit_id" class="form-control" id="input-length_unit_id">
										<volist name="length_unit_list" id="length_unit">
											<option value="{$length_unit['length_unit_id']}">{$length_unit['title']}</option>
										</volist>
										</select>
									</div>
								</div>

								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-weight">重量</label>
									<div class="col-sm-10">
										<input type="text" name="weight" value="0" placeholder="weight" id="input-weight" class="form-control" />
									</div>
								</div>

								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-weight_unit_id">重量单位</label>
									<div class="col-sm-10">
										<select name="weight_unit_id" class="form-control" id="input-weight_unit_id">
										<volist name="weight_unit_list" id="weight_unit">
											<option value="{$weight_unit['weight_unit_id']}">{$weight_unit['title']}</option>
										</volist>
										</select>
									</div>
								</div>
											
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-is_status">是否可以销售</label>
									<div class="col-sm-10">
										<input type="checkbox" name="is_status" value="1" checked id="input-is_status" class="form-control" />
									</div>
								</div>
																
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-is_new">是否新品</label>
									<div class="col-sm-10">
										<input type="checkbox" name="is_new" value="1" id="input-is_new" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-is_promote">是否推荐</label>
									<div class="col-sm-10">
										<input type="checkbox" name="is_promote" value="" id="input-is_promote" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-sort_number">排序</label>
									<div class="col-sm-10">
										<input type="text" name="sort_number" value="0" placeholder="sort_number" id="input-sort_number" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-tax_id">税类型</label>
									<div class="col-sm-10">
										<select name="tax_id" class="form-control" id="input-tax_id">
											<option value="0">无</option>
										<volist name="tax_list" id="tax">
											<option value="{$tax['tax_id']}">{$tax['title']}</option>
										</volist>
										</select>
									</div>
								</div>							
						
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-stock_status_id">库存状态</label>
									<div class="col-sm-10">
										<select name="stock_status_id" class="form-control" id="input-stock_status_id">
										<volist name="stock_status_list" id="stock_status">
											<option value="{$stock_status['stock_status_id']}">{$stock_status['title']}</option>
										</volist>
										</select>
									</div>
								</div>
								
								
							</div>

							<div class="tab-pane" id="tab-description">

								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-description">商品描述</label>
									<div class="col-sm-10">
										<textarea name="description" value="" placeholder="description" id="input-description" class="form-control" ></textarea>
									</div>
								</div>

							</div>


							<div class="tab-pane" id="tab-seo">
							
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-meta_title">META标题</label>
									<div class="col-sm-10">
										<input type="text" name="meta_title" value="" placeholder="META标题" id="input-meta_title" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-meta_keywords">META关键字</label>
									<div class="col-sm-10">
										<input type="text" name="meta_keywords" value="" placeholder="META关键字" id="input-meta_keywords" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-meta_description">META描述</label>
									<div class="col-sm-10">
										<textarea name="meta_description" value="" placeholder="META描述" id="input-meta_description" class="form-control" ></textarea>
									</div>
								</div>

							</div>


							<div class="tab-pane" id="tab-linked">
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-brand_id">品牌</label>
									<div class="col-sm-10">
										<select name="brand_id" class="form-control" id="input-brand_id">
										<option value="0">未选择</option>
										<volist name="brand_list" id="brand">
											<option value="{$brand['brand_id']}">{$brand['brand_title']}</option>
										</volist>
										</select>
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-category_id">商品分类</label>
									<div class="col-sm-10">
										<select name="category_id" class="form-control" id="input-category_id">
										<volist name="category_list" id="category">
											<option value="{$category['category_id']}">{:str_repeat('&nbsp;', $category['deep']*4)}{$category['title']}</option>
										</volist>
										</select>
									</div>
								</div>
							</div>


							<div class="tab-pane" id="tab-gallery">

								<table id="images" class="table table-striped table-bordered table-hover">
					                <thead>
					                  <tr>
					                    <td class="text-left">图片</td>
					                    <td class="text-left">排序</td>
					                    <td></td>
					                  </tr>
					                </thead>
					                <tbody>
					                </tbody>
					                <tfoot>
					                  <tr>
					                    <td colspan="2"></td>
					                    <td class="text-left">
					                      <button data-original-title="添加图片" type="button" onclick="addImage();" data-toggle="tooltip" title="" class="btn btn-primary">
					                        <i class="fa fa-plus-circle"></i>
					                      </button>
					                    </td>
					                  </tr>
					                </tfoot>
					              </table>
							</div>


							<div class="tab-pane" id="tab-attribute">

								<div class="form-group">
					              <label for="input-attribute_group_id" class="col-sm-2 control-label">
					                <span title="" data-toggle="tooltip" data-original-title="">属性分组(商品类型)</span>
					              </label>
					              <div class="col-sm-1">

					              </div>
					              <div class="col-sm-9">
					                <select class="form-control" id="input-attribute_group_id" name="attribute_group_id">
					                  <option value="0">--未选择--</option>
					                <volist name="attribute_group_list" id="attribute_group">
					                  <option value="{$attribute_group['attribute_group_id']}">{$attribute_group['title']}</option>
					             	</volist>
					                </select>
					              </div>
					            </div
							</div>

						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

</block>

<block name="stylesheet">
	<link href="__PUBLIC__/Back/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css" rel="stylesheet" media="screen" />
	<link href="__PUBLIC__/Back/summernote/summernote.css" rel="stylesheet" />
</block>

<block name="bottomJS">
	<script src="__PUBLIC__/Back/datetimepicker/moment.js" type="text/javascript"></script>
	<script src="__PUBLIC__/Back/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/Back/summernote/summernote.js"></script>

	<script>
	// 初始化时间日期插件
	$('.date').datetimepicker({
		pickDate: true,
		pickTime: false
	});

	// 初始化 商品描述编辑器
	$('#input-description').summernote({height: 600});

	// 商品相册图片添加的操作函数
	var image_row = 0;
	function addImage() {
		html  = '<tr id="image-row' + image_row + '">';
		html += '<td class="text-left"><input type="file" name="gallery_image[' + image_row + ']"></td>';
		html += '<td class="text-left"><input name="gallery_sort[' + image_row +']" value="0" placeholder="排序" class="form-control" type="text"></td>';
		html += '  <td class="text-left"><button type="button" onclick="$(\'#image-row' + image_row  + '\').remove();" data-toggle="tooltip" title="移除" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
		html += '</tr>';

		$('#images tbody').append(html);

		++ image_row;
	}


	// 属性分组 获取组内属性列表
	$('#input-attribute_group_id').change(function() {
		// 清除当前的属性
		$('#tab-attribute .form-group:gt(0)').remove();
		// 利用当前属性分组ID的值, 获取组内的属性
		var url = '{:U('getAttribute')}';
		var data = {
			group_id: $(this).val()
		};
		$.get(url, data, function(response){

			if (response.error == 0) { // 如果没有错误
				// 遍历属性列表
				for (var i=0; i<response.rows.length; ++i) {
					var attribute = response.rows[i];
					// 每个属性生成一个 输入元素
					var inputElement = '<div class="form-group"> <label class="col-sm-2 control-label" for="input-attribute-' + attribute.attribute_id + '">' + attribute.title + '</label>';


					// 根据不同的输入类型 进行不同的元素展示
					switch (attribute.type_title) {
						case 'text':
							inputElement += ' <div class="col-sm-1 text-center"> <label class="control-label"> </label> </div> <div class="col-sm-9">';
							inputElement += '<input name="attribute[' + attribute.attribute_id + ']" value="" placeholder="属性值" id="input-attribute-' + attribute.attribute_id + '" class="form-control" type="text">';
						break;
						case 'select':
							inputElement += ' <div class="col-sm-1 text-center"> <label class="control-label"> </label> </div> <div class="col-sm-9">';
							inputElement += '<select name="attribute[' + attribute.attribute_id + ']" id="input-attribute-' + attribute.attribute_id + '" class="form-control" >';
							// 选项部分
							for(var j=0; j<attribute.option.length; ++j) {
								inputElement += '<option value="' + attribute.option[j].attribute_option_id + '">' + attribute.option[j].value + '</option>';
							}

							inputElement += '</select>';
						break;
						case 'select_multiple':
						// 多选属性, 增加checkbox, 用户指定哪个属性是选项
							inputElement += ' <div class="col-sm-1 text-center"> <label class="control-label"> <input type="checkbox" name="option[]" value="' + attribute.attribute_id +'" /></label> </div> <div class="col-sm-9">';
							inputElement += '<select multiple size="3" name="attribute[' + attribute.attribute_id + '][]" id="input-attribute-' + attribute.attribute_id + '" class="form-control" >';
							// 选项部分
							for(var j=0; j<attribute.option.length; ++j) {
								inputElement += '<option value="' + attribute.option[j].attribute_option_id + '">' + attribute.option[j].value + '</option>';
							}

							inputElement += '</select>';
						break;
					}



					inputElement += ' </div> </div>';
					// 将其添加到 tab-attribute 内部
					$('#tab-attribute').append(inputElement);
				}
			}

		}, 'json');
		// 设计, 响应数据的格式, rows 存储每个属性的全部数据, error属性表示是否存在错误

	});
	</script>
</block>